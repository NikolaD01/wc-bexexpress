var pt=Object.defineProperty;var gt=(s,t,e)=>t in s?pt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var m=(s,t,e)=>gt(s,typeof t!="symbol"?t+"":t,e);import{A as K}from"./assets/ajax.service-CvjR3zXt.js";const nt={async fetchCities(s,t){return await new K(s).post("checkout_cities",{municipalities_name:t})},async fetchStreets(s,t){return await new K(s).post("checkout_streets",{place_id:t})}};function G(s,t){let e=null;return(...n)=>{e!==null&&clearTimeout(e),e=window.setTimeout(()=>{s(...n),e=null},t)}}class mt{constructor(t,e,n,i){m(this,"ajaxUrl");m(this,"stateField");m(this,"cityField");m(this,"streetField");m(this,"debouncedOnStateChange");this.ajaxUrl=t;const r=document.querySelector(`#${e}`),c=document.querySelector(`#${n}`),o=document.querySelector(`#${i}`);if(!r||!c)throw new Error("State or city field not found in the DOM");this.stateField=r,this.cityField=c,this.streetField=o,this.debouncedOnStateChange=G(this.onStateChangeFromTitleChange.bind(this),300),this.init()}init(){new MutationObserver(e=>{for(const n of e)if(n.type==="attributes"&&n.attributeName==="title"){const i=this.stateField.title;this.debouncedOnStateChange(i)}}).observe(this.stateField,{attributes:!0})}async onStateChangeFromTitleChange(t){if(!t){this.clearCities();return}this.clearStreets();try{const e=await nt.fetchCities(this.ajaxUrl,t);this.populateCities(e.data)}catch(e){console.error("Failed to load cities:",e)}}clearStreets(){this.streetField.innerHTML="<option value=''>Izaberite ulicu</option>",this.streetField.disabled=!0}clearCities(){this.cityField.innerHTML="<option value=''>Izaberite podruƒçje</option>",this.cityField.disabled=!0}populateCities(t){this.cityField.innerHTML="",t.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.name,this.cityField.appendChild(n)}),this.cityField.disabled=!1}}class yt{constructor(t,e,n){m(this,"ajaxUrl");m(this,"cityField");m(this,"streetField");m(this,"debouncedOnCityChange");this.ajaxUrl=t;const i=document.querySelector(`#${e}`),r=document.querySelector(`#${n}`);if(!r||!i)throw new Error("Street or city field not found in the DOM");this.cityField=i,this.streetField=r,this.debouncedOnCityChange=G(this.onCityChange.bind(this),300),this.init()}init(){this.cityField.addEventListener("change",t=>{const e=t.target.value;this.debouncedOnCityChange(e)})}async onCityChange(t){if(!t){this.clearStreets();return}try{const e=await nt.fetchStreets(this.ajaxUrl,t);this.populateStreets(e.data)}catch(e){console.error("Failed to load streets:",e)}}clearStreets(){this.streetField.innerHTML="<option value=''>Select a city first</option>",this.streetField.disabled=!0}populateStreets(t){this.streetField.innerHTML="",t.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.name,this.streetField.appendChild(n)}),this.streetField.disabled=!1}}function w(s){return Array.isArray?Array.isArray(s):ct(s)==="[object Array]"}const Et=1/0;function Mt(s){if(typeof s=="string")return s;let t=s+"";return t=="0"&&1/s==-Et?"-0":t}function _t(s){return s==null?"":Mt(s)}function x(s){return typeof s=="string"}function it(s){return typeof s=="number"}function xt(s){return s===!0||s===!1||St(s)&&ct(s)=="[object Boolean]"}function rt(s){return typeof s=="object"}function St(s){return rt(s)&&s!==null}function y(s){return s!=null}function P(s){return!s.trim().length}function ct(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}const wt="Incorrect 'index' type",It=s=>`Invalid value for key ${s}`,bt=s=>`Pattern length exceeds max of ${s}.`,Ct=s=>`Missing ${s} property in key`,Ft=s=>`Property 'weight' in key '${s}' must be a positive integer`,Z=Object.prototype.hasOwnProperty;class At{constructor(t){this._keys=[],this._keyMap={};let e=0;t.forEach(n=>{let i=ot(n);this._keys.push(i),this._keyMap[i.id]=i,e+=i.weight}),this._keys.forEach(n=>{n.weight/=e})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function ot(s){let t=null,e=null,n=null,i=1,r=null;if(x(s)||w(s))n=s,t=q(s),e=U(s);else{if(!Z.call(s,"name"))throw new Error(Ct("name"));const c=s.name;if(n=c,Z.call(s,"weight")&&(i=s.weight,i<=0))throw new Error(Ft(c));t=q(c),e=U(c),r=s.getFn}return{path:t,id:e,weight:i,src:n,getFn:r}}function q(s){return w(s)?s:s.split(".")}function U(s){return w(s)?s.join("."):s}function Lt(s,t){let e=[],n=!1;const i=(r,c,o)=>{if(y(r))if(!c[o])e.push(r);else{let a=c[o];const l=r[a];if(!y(l))return;if(o===c.length-1&&(x(l)||it(l)||xt(l)))e.push(_t(l));else if(w(l)){n=!0;for(let h=0,d=l.length;h<d;h+=1)i(l[h],c,o+1)}else c.length&&i(l,c,o+1)}};return i(s,x(t)?t.split("."):t,0),n?e:e[0]}const vt={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Ot={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(s,t)=>s.score===t.score?s.idx<t.idx?-1:1:s.score<t.score?-1:1},jt={location:0,threshold:.6,distance:100},Rt={useExtendedSearch:!1,getFn:Lt,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var u={...Ot,...vt,...jt,...Rt};const $t=/[^ ]+/g;function kt(s=1,t=3){const e=new Map,n=Math.pow(10,t);return{get(i){const r=i.match($t).length;if(e.has(r))return e.get(r);const c=1/Math.pow(r,.5*s),o=parseFloat(Math.round(c*n)/n);return e.set(r,o),o},clear(){e.clear()}}}class Q{constructor({getFn:t=u.getFn,fieldNormWeight:e=u.fieldNormWeight}={}){this.norm=kt(e,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((e,n)=>{this._keysMap[e.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,x(this.docs[0])?this.docs.forEach((t,e)=>{this._addString(t,e)}):this.docs.forEach((t,e)=>{this._addObject(t,e)}),this.norm.clear())}add(t){const e=this.size();x(t)?this._addString(t,e):this._addObject(t,e)}removeAt(t){this.records.splice(t,1);for(let e=t,n=this.size();e<n;e+=1)this.records[e].i-=1}getValueForItemAtKeyId(t,e){return t[this._keysMap[e]]}size(){return this.records.length}_addString(t,e){if(!y(t)||P(t))return;let n={v:t,i:e,n:this.norm.get(t)};this.records.push(n)}_addObject(t,e){let n={i:e,$:{}};this.keys.forEach((i,r)=>{let c=i.getFn?i.getFn(t):this.getFn(t,i.path);if(y(c)){if(w(c)){let o=[];const a=[{nestedArrIndex:-1,value:c}];for(;a.length;){const{nestedArrIndex:l,value:h}=a.pop();if(y(h))if(x(h)&&!P(h)){let d={v:h,i:l,n:this.norm.get(h)};o.push(d)}else w(h)&&h.forEach((d,f)=>{a.push({nestedArrIndex:f,value:d})})}n.$[r]=o}else if(x(c)&&!P(c)){let o={v:c,n:this.norm.get(c)};n.$[r]=o}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function at(s,t,{getFn:e=u.getFn,fieldNormWeight:n=u.fieldNormWeight}={}){const i=new Q({getFn:e,fieldNormWeight:n});return i.setKeys(s.map(ot)),i.setSources(t),i.create(),i}function Nt(s,{getFn:t=u.getFn,fieldNormWeight:e=u.fieldNormWeight}={}){const{keys:n,records:i}=s,r=new Q({getFn:t,fieldNormWeight:e});return r.setKeys(n),r.setIndexRecords(i),r}function k(s,{errors:t=0,currentLocation:e=0,expectedLocation:n=0,distance:i=u.distance,ignoreLocation:r=u.ignoreLocation}={}){const c=t/s.length;if(r)return c;const o=Math.abs(n-e);return i?c+o/i:o?1:c}function Tt(s=[],t=u.minMatchCharLength){let e=[],n=-1,i=-1,r=0;for(let c=s.length;r<c;r+=1){let o=s[r];o&&n===-1?n=r:!o&&n!==-1&&(i=r-1,i-n+1>=t&&e.push([n,i]),n=-1)}return s[r-1]&&r-n>=t&&e.push([n,r-1]),e}const L=32;function Dt(s,t,e,{location:n=u.location,distance:i=u.distance,threshold:r=u.threshold,findAllMatches:c=u.findAllMatches,minMatchCharLength:o=u.minMatchCharLength,includeMatches:a=u.includeMatches,ignoreLocation:l=u.ignoreLocation}={}){if(t.length>L)throw new Error(bt(L));const h=t.length,d=s.length,f=Math.max(0,Math.min(n,d));let p=r,g=f;const E=o>1||a,F=E?Array(d):[];let S;for(;(S=s.indexOf(t,g))>-1;){let M=k(t,{currentLocation:S,expectedLocation:f,distance:i,ignoreLocation:l});if(p=Math.min(M,p),g=S+h,E){let I=0;for(;I<h;)F[S+I]=1,I+=1}}g=-1;let v=[],A=1,R=h+d;const ft=1<<h-1;for(let M=0;M<h;M+=1){let I=0,b=R;for(;I<b;)k(t,{errors:M,currentLocation:f+b,expectedLocation:f,distance:i,ignoreLocation:l})<=p?I=b:R=b,b=Math.floor((R-I)/2+I);R=b;let X=Math.max(1,f-b+1),D=c?d:Math.min(f+b,d)+h,O=Array(D+2);O[D+1]=(1<<M)-1;for(let _=D;_>=X;_-=1){let $=_-1,J=e[s.charAt($)];if(E&&(F[$]=+!!J),O[_]=(O[_+1]<<1|1)&J,M&&(O[_]|=(v[_+1]|v[_])<<1|1|v[_+1]),O[_]&ft&&(A=k(t,{errors:M,currentLocation:$,expectedLocation:f,distance:i,ignoreLocation:l}),A<=p)){if(p=A,g=$,g<=f)break;X=Math.max(1,2*f-g)}}if(k(t,{errors:M+1,currentLocation:f,expectedLocation:f,distance:i,ignoreLocation:l})>p)break;v=O}const T={isMatch:g>=0,score:Math.max(.001,A)};if(E){const M=Tt(F,o);M.length?a&&(T.indices=M):T.isMatch=!1}return T}function Pt(s){let t={};for(let e=0,n=s.length;e<n;e+=1){const i=s.charAt(e);t[i]=(t[i]||0)|1<<n-e-1}return t}class lt{constructor(t,{location:e=u.location,threshold:n=u.threshold,distance:i=u.distance,includeMatches:r=u.includeMatches,findAllMatches:c=u.findAllMatches,minMatchCharLength:o=u.minMatchCharLength,isCaseSensitive:a=u.isCaseSensitive,ignoreLocation:l=u.ignoreLocation}={}){if(this.options={location:e,threshold:n,distance:i,includeMatches:r,findAllMatches:c,minMatchCharLength:o,isCaseSensitive:a,ignoreLocation:l},this.pattern=a?t:t.toLowerCase(),this.chunks=[],!this.pattern.length)return;const h=(f,p)=>{this.chunks.push({pattern:f,alphabet:Pt(f),startIndex:p})},d=this.pattern.length;if(d>L){let f=0;const p=d%L,g=d-p;for(;f<g;)h(this.pattern.substr(f,L),f),f+=L;if(p){const E=d-L;h(this.pattern.substr(E),E)}}else h(this.pattern,0)}searchIn(t){const{isCaseSensitive:e,includeMatches:n}=this.options;if(e||(t=t.toLowerCase()),this.pattern===t){let g={isMatch:!0,score:0};return n&&(g.indices=[[0,t.length-1]]),g}const{location:i,distance:r,threshold:c,findAllMatches:o,minMatchCharLength:a,ignoreLocation:l}=this.options;let h=[],d=0,f=!1;this.chunks.forEach(({pattern:g,alphabet:E,startIndex:F})=>{const{isMatch:S,score:v,indices:A}=Dt(t,g,E,{location:i+F,distance:r,threshold:c,findAllMatches:o,minMatchCharLength:a,includeMatches:n,ignoreLocation:l});S&&(f=!0),d+=v,S&&A&&(h=[...h,...A])});let p={isMatch:f,score:f?d/this.chunks.length:1};return f&&n&&(p.indices=h),p}}class C{constructor(t){this.pattern=t}static isMultiMatch(t){return tt(t,this.multiRegex)}static isSingleMatch(t){return tt(t,this.singleRegex)}search(){}}function tt(s,t){const e=s.match(t);return e?e[1]:null}class Ht extends C{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const e=t===this.pattern;return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class Kt extends C{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const n=t.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}}class Ut extends C{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const e=t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class Bt extends C{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const e=!t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class zt extends C{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const e=t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class Wt extends C{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const e=!t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class ht extends C{constructor(t,{location:e=u.location,threshold:n=u.threshold,distance:i=u.distance,includeMatches:r=u.includeMatches,findAllMatches:c=u.findAllMatches,minMatchCharLength:o=u.minMatchCharLength,isCaseSensitive:a=u.isCaseSensitive,ignoreLocation:l=u.ignoreLocation}={}){super(t),this._bitapSearch=new lt(t,{location:e,threshold:n,distance:i,includeMatches:r,findAllMatches:c,minMatchCharLength:o,isCaseSensitive:a,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class ut extends C{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let e=0,n;const i=[],r=this.pattern.length;for(;(n=t.indexOf(this.pattern,e))>-1;)e=n+r,i.push([n,e-1]);const c=!!i.length;return{isMatch:c,score:c?0:1,indices:i}}}const B=[Ht,ut,Ut,Bt,Wt,zt,Kt,ht],et=B.length,Vt=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Yt="|";function Gt(s,t={}){return s.split(Yt).map(e=>{let n=e.trim().split(Vt).filter(r=>r&&!!r.trim()),i=[];for(let r=0,c=n.length;r<c;r+=1){const o=n[r];let a=!1,l=-1;for(;!a&&++l<et;){const h=B[l];let d=h.isMultiMatch(o);d&&(i.push(new h(d,t)),a=!0)}if(!a)for(l=-1;++l<et;){const h=B[l];let d=h.isSingleMatch(o);if(d){i.push(new h(d,t));break}}}return i})}const Qt=new Set([ht.type,ut.type]);class Xt{constructor(t,{isCaseSensitive:e=u.isCaseSensitive,includeMatches:n=u.includeMatches,minMatchCharLength:i=u.minMatchCharLength,ignoreLocation:r=u.ignoreLocation,findAllMatches:c=u.findAllMatches,location:o=u.location,threshold:a=u.threshold,distance:l=u.distance}={}){this.query=null,this.options={isCaseSensitive:e,includeMatches:n,minMatchCharLength:i,findAllMatches:c,ignoreLocation:r,location:o,threshold:a,distance:l},this.pattern=e?t:t.toLowerCase(),this.query=Gt(this.pattern,this.options)}static condition(t,e){return e.useExtendedSearch}searchIn(t){const e=this.query;if(!e)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:i}=this.options;t=i?t:t.toLowerCase();let r=0,c=[],o=0;for(let a=0,l=e.length;a<l;a+=1){const h=e[a];c.length=0,r=0;for(let d=0,f=h.length;d<f;d+=1){const p=h[d],{isMatch:g,indices:E,score:F}=p.search(t);if(g){if(r+=1,o+=F,n){const S=p.constructor.type;Qt.has(S)?c=[...c,...E]:c.push(E)}}else{o=0,r=0,c.length=0;break}}if(r){let d={isMatch:!0,score:o/r};return n&&(d.indices=c),d}}return{isMatch:!1,score:1}}}const z=[];function Jt(...s){z.push(...s)}function W(s,t){for(let e=0,n=z.length;e<n;e+=1){let i=z[e];if(i.condition(s,t))return new i(s,t)}return new lt(s,t)}const N={AND:"$and",OR:"$or"},V={PATH:"$path",PATTERN:"$val"},Y=s=>!!(s[N.AND]||s[N.OR]),Zt=s=>!!s[V.PATH],qt=s=>!w(s)&&rt(s)&&!Y(s),st=s=>({[N.AND]:Object.keys(s).map(t=>({[t]:s[t]}))});function dt(s,t,{auto:e=!0}={}){const n=i=>{let r=Object.keys(i);const c=Zt(i);if(!c&&r.length>1&&!Y(i))return n(st(i));if(qt(i)){const a=c?i[V.PATH]:r[0],l=c?i[V.PATTERN]:i[a];if(!x(l))throw new Error(It(a));const h={keyId:U(a),pattern:l};return e&&(h.searcher=W(l,t)),h}let o={children:[],operator:r[0]};return r.forEach(a=>{const l=i[a];w(l)&&l.forEach(h=>{o.children.push(n(h))})}),o};return Y(s)||(s=st(s)),n(s)}function te(s,{ignoreFieldNorm:t=u.ignoreFieldNorm}){s.forEach(e=>{let n=1;e.matches.forEach(({key:i,norm:r,score:c})=>{const o=i?i.weight:null;n*=Math.pow(c===0&&o?Number.EPSILON:c,(o||1)*(t?1:r))}),e.score=n})}function ee(s,t){const e=s.matches;t.matches=[],y(e)&&e.forEach(n=>{if(!y(n.indices)||!n.indices.length)return;const{indices:i,value:r}=n;let c={indices:i,value:r};n.key&&(c.key=n.key.src),n.idx>-1&&(c.refIndex=n.idx),t.matches.push(c)})}function se(s,t){t.score=s.score}function ne(s,t,{includeMatches:e=u.includeMatches,includeScore:n=u.includeScore}={}){const i=[];return e&&i.push(ee),n&&i.push(se),s.map(r=>{const{idx:c}=r,o={item:t[c],refIndex:c};return i.length&&i.forEach(a=>{a(r,o)}),o})}class j{constructor(t,e={},n){this.options={...u,...e},this.options.useExtendedSearch,this._keyStore=new At(this.options.keys),this.setCollection(t,n)}setCollection(t,e){if(this._docs=t,e&&!(e instanceof Q))throw new Error(wt);this._myIndex=e||at(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){y(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const e=[];for(let n=0,i=this._docs.length;n<i;n+=1){const r=this._docs[n];t(r,n)&&(this.removeAt(n),n-=1,i-=1,e.push(r))}return e}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:e=-1}={}){const{includeMatches:n,includeScore:i,shouldSort:r,sortFn:c,ignoreFieldNorm:o}=this.options;let a=x(t)?x(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return te(a,{ignoreFieldNorm:o}),r&&a.sort(c),it(e)&&e>-1&&(a=a.slice(0,e)),ne(a,this._docs,{includeMatches:n,includeScore:i})}_searchStringList(t){const e=W(t,this.options),{records:n}=this._myIndex,i=[];return n.forEach(({v:r,i:c,n:o})=>{if(!y(r))return;const{isMatch:a,score:l,indices:h}=e.searchIn(r);a&&i.push({item:r,idx:c,matches:[{score:l,value:r,norm:o,indices:h}]})}),i}_searchLogical(t){const e=dt(t,this.options),n=(o,a,l)=>{if(!o.children){const{keyId:d,searcher:f}=o,p=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(a,d),searcher:f});return p&&p.length?[{idx:l,item:a,matches:p}]:[]}const h=[];for(let d=0,f=o.children.length;d<f;d+=1){const p=o.children[d],g=n(p,a,l);if(g.length)h.push(...g);else if(o.operator===N.AND)return[]}return h},i=this._myIndex.records,r={},c=[];return i.forEach(({$:o,i:a})=>{if(y(o)){let l=n(e,o,a);l.length&&(r[a]||(r[a]={idx:a,item:o,matches:[]},c.push(r[a])),l.forEach(({matches:h})=>{r[a].matches.push(...h)}))}}),c}_searchObjectList(t){const e=W(t,this.options),{keys:n,records:i}=this._myIndex,r=[];return i.forEach(({$:c,i:o})=>{if(!y(c))return;let a=[];n.forEach((l,h)=>{a.push(...this._findMatches({key:l,value:c[h],searcher:e}))}),a.length&&r.push({idx:o,item:c,matches:a})}),r}_findMatches({key:t,value:e,searcher:n}){if(!y(e))return[];let i=[];if(w(e))e.forEach(({v:r,i:c,n:o})=>{if(!y(r))return;const{isMatch:a,score:l,indices:h}=n.searchIn(r);a&&i.push({score:l,key:t,value:r,idx:c,norm:o,indices:h})});else{const{v:r,n:c}=e,{isMatch:o,score:a,indices:l}=n.searchIn(r);o&&i.push({score:a,key:t,value:r,norm:c,indices:l})}return i}}j.version="7.0.0";j.createIndex=at;j.parseIndex=Nt;j.config=u;j.parseQuery=dt;Jt(Xt);const ie={async fetch(s,t,e){return(await new K(s).post(e,{query:t})).data}};class H{constructor(t,e,n){m(this,"containerId");m(this,"ajaxUrl");m(this,"action");m(this,"inputElement",null);m(this,"hiddenInputElement",null);m(this,"dropdown",null);m(this,"fuse",null);m(this,"fetchDataDebounced");m(this,"userSelected",!1);this.containerId=t,this.ajaxUrl=e,this.action=n,this.fetchDataDebounced=G(this.fetchData.bind(this),300),this.initAutocomplete()}initAutocomplete(){var t,e,n,i;this.inputElement=document.querySelector(`#${this.containerId}_display`),this.hiddenInputElement=document.querySelector(`#${this.containerId}`),this.dropdown=document.createElement("ul"),this.dropdown.classList.add("autocomplete-dropdown"),(e=(t=this.inputElement)==null?void 0:t.parentNode)==null||e.appendChild(this.dropdown),(n=this.inputElement)==null||n.addEventListener("input",r=>{const c=r.target.value.trim();this.userSelected=!1,c.length>1?this.fetchDataDebounced(c):(this.clearDropdown(),this.hiddenInputElement&&(this.hiddenInputElement.value=c))}),(i=this.inputElement)==null||i.addEventListener("blur",()=>{!this.userSelected&&this.inputElement&&(this.hiddenInputElement.value=this.inputElement.value)})}async fetchData(t){try{const e=await ie.fetch(this.ajaxUrl,t,this.action);e?(this.setupFuse(e),this.updateDropdown(t)):this.clearDropdown()}catch(e){console.error("Fetch error:",e),this.clearDropdown()}}setupFuse(t){this.fuse=new j(t,{keys:["name"],threshold:.3})}updateDropdown(t){if(!this.dropdown||!this.fuse)return;this.clearDropdown(),this.fuse.search(t).forEach(({item:n})=>{const i=document.createElement("li");i.textContent=n.name,i.dataset.id=n.id,i.addEventListener("click",()=>{this.selectItem(n)}),this.dropdown.appendChild(i)})}clearDropdown(){this.dropdown&&(this.dropdown.innerHTML="")}selectItem(t){this.inputElement&&this.hiddenInputElement&&(this.userSelected=!0,this.inputElement.value=t.name,this.hiddenInputElement.value=t.id),this.clearDropdown()}}const re=()=>{setTimeout(function(){if(document.getElementById("bex-autocomplete"))new H("billing_state",window.admin_globals.ajax_url,"get_municipalities"),new H("billing_city",window.admin_globals.ajax_url,"get_places"),new H("billing_address_1",window.admin_globals.ajax_url,"get_streets");else{const t=document.getElementById("select2-billing_state-container"),e=document.getElementById("billing_city");if(t&&e)try{new mt(window.admin_globals.ajax_url,"select2-billing_state-container","billing_city","billing_address_1"),new yt(window.admin_globals.ajax_url,"billing_city","billing_address_1")}catch(n){console.error("CitySelector Initialization Error:",n)}}},1e3)};document.addEventListener("DOMContentLoaded",re);
