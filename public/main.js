var F=Object.defineProperty;var p=(o,n,s)=>n in o?F(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s;var r=(o,n,s)=>p(o,typeof n!="symbol"?n+"":n,s);(function(){"use strict";class o{constructor(i){r(this,"ajaxUrl");this.ajaxUrl=i}async post(i,e){try{const t=await fetch(this.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"wc_bex_manager",action_name:i,...e}).toString()});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}catch(t){throw console.error("AJAX Error:",t),t}}}function n(a,i){let e=null;return(...t)=>{e!==null&&clearTimeout(e),e=window.setTimeout(()=>{a(...t),e=null},i)}}class s{constructor(i,e,t,c){r(this,"ajaxService");r(this,"stateField");r(this,"cityField");r(this,"streetField");r(this,"debouncedOnStateChange");this.ajaxService=new o(i);const l=document.querySelector(`#${e}`),d=document.querySelector(`#${t}`),y=document.querySelector(`#${c}`);if(!l||!d)throw new Error("State or city field not found in the DOM");this.stateField=l,this.cityField=d,this.streetField=y,this.debouncedOnStateChange=n(this.onStateChangeFromTitleChange.bind(this),300),this.init()}init(){this.stateField&&new MutationObserver(e=>{for(const t of e)if(t.type==="attributes"&&t.attributeName==="title"){const c=this.stateField.title;this.debouncedOnStateChange(c)}}).observe(this.stateField,{attributes:!0})}async onStateChangeFromTitleChange(i){if(!i){this.clearCities();return}this.clearStreets();try{const e=await this.ajaxService.post("checkout_cities",{municipalities_name:i});this.populateCities(e.data)}catch(e){console.error("Failed to load cities:",e)}}clearStreets(){this.streetField.innerHTML="<option value=''>Izaberite ulicu</option>>",this.streetField.disabled=!0}clearCities(){this.cityField.innerHTML="<option value=''>Izaberite podruƒçje</option>",this.cityField.disabled=!0}populateCities(i){this.cityField.innerHTML="",i.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,this.cityField.appendChild(t)}),this.cityField.disabled=!1}}class h{constructor(i,e,t){r(this,"ajaxService");r(this,"cityField");r(this,"streetField");r(this,"debouncedOnCityChange");this.ajaxService=new o(i);const c=document.querySelector(`#${e}`),l=document.querySelector(`#${t}`);if(!l||!c)throw new Error("Street or city field not found in the DOM");this.cityField=c,this.streetField=l,this.debouncedOnCityChange=n(this.onCityChange.bind(this),300),this.init()}init(){this.cityField.addEventListener("change",i=>{const e=i.target.value;this.debouncedOnCityChange(e)})}async onCityChange(i){if(!i){this.clearStreets();return}try{const e=await this.ajaxService.post("checkout_streets",{place_id:i});this.populateStreets(e.data)}catch(e){console.error("Failed to load streets:",e)}}clearStreets(){this.streetField.innerHTML="<option value=''>Select a city first</option>",this.streetField.disabled=!0}populateStreets(i){this.streetField.innerHTML="",i.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,this.streetField.appendChild(t)}),this.streetField.disabled=!1}}const u=()=>{try{setTimeout(function(){new s(window.admin_globals.ajax_url,"select2-billing_state-container","billing_city","billing_address_1"),new h(window.admin_globals.ajax_url,"billing_city","billing_address_1")},1e3)}catch(a){console.error("CitySelector Initialization Error:",a)}};document.addEventListener("DOMContentLoaded",u)})();
