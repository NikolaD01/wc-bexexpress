var u=Object.defineProperty;var y=(n,t,e)=>t in n?u(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>y(n,typeof t!="symbol"?t+"":t,e);import{A as l}from"./assets/ajax.service-CvjR3zXt.js";const c={async fetchCities(n,t){return await new l(n).post("checkout_cities",{municipalities_name:t})},async fetchStreets(n,t){return await new l(n).post("checkout_streets",{place_id:t})}};function d(n,t){let e=null;return(...i)=>{e!==null&&clearTimeout(e),e=window.setTimeout(()=>{n(...i),e=null},t)}}class F{constructor(t,e,i,s){r(this,"ajaxUrl");r(this,"stateField");r(this,"cityField");r(this,"streetField");r(this,"debouncedOnStateChange");this.ajaxUrl=t;const o=document.querySelector(`#${e}`),a=document.querySelector(`#${i}`),h=document.querySelector(`#${s}`);if(!o||!a)throw new Error("State or city field not found in the DOM");this.stateField=o,this.cityField=a,this.streetField=h,this.debouncedOnStateChange=d(this.onStateChangeFromTitleChange.bind(this),300),this.init()}init(){new MutationObserver(e=>{for(const i of e)if(i.type==="attributes"&&i.attributeName==="title"){const s=this.stateField.title;this.debouncedOnStateChange(s)}}).observe(this.stateField,{attributes:!0})}async onStateChangeFromTitleChange(t){if(!t){this.clearCities();return}this.clearStreets();try{const e=await c.fetchCities(this.ajaxUrl,t);this.populateCities(e.data)}catch(e){console.error("Failed to load cities:",e)}}clearStreets(){this.streetField.innerHTML="<option value=''>Izaberite ulicu</option>",this.streetField.disabled=!0}clearCities(){this.cityField.innerHTML="<option value=''>Izaberite podruƒçje</option>",this.cityField.disabled=!0}populateCities(t){this.cityField.innerHTML="",t.forEach(e=>{const i=document.createElement("option");i.value=e.id,i.textContent=e.name,this.cityField.appendChild(i)}),this.cityField.disabled=!1}}class b{constructor(t,e,i){r(this,"ajaxUrl");r(this,"cityField");r(this,"streetField");r(this,"debouncedOnCityChange");this.ajaxUrl=t;const s=document.querySelector(`#${e}`),o=document.querySelector(`#${i}`);if(!o||!s)throw new Error("Street or city field not found in the DOM");this.cityField=s,this.streetField=o,this.debouncedOnCityChange=d(this.onCityChange.bind(this),300),this.init()}init(){this.cityField.addEventListener("change",t=>{const e=t.target.value;this.debouncedOnCityChange(e)})}async onCityChange(t){if(!t){this.clearStreets();return}try{const e=await c.fetchStreets(this.ajaxUrl,t);this.populateStreets(e.data)}catch(e){console.error("Failed to load streets:",e)}}clearStreets(){this.streetField.innerHTML="<option value=''>Select a city first</option>",this.streetField.disabled=!0}populateStreets(t){this.streetField.innerHTML="",t.forEach(e=>{const i=document.createElement("option");i.value=e.id,i.textContent=e.name,this.streetField.appendChild(i)}),this.streetField.disabled=!1}}const S=()=>{setTimeout(function(){const n=document.getElementById("select2-billing_state-container"),t=document.getElementById("billing_city");if(n&&t)try{new F(window.admin_globals.ajax_url,"select2-billing_state-container","billing_city","billing_address_1"),new b(window.admin_globals.ajax_url,"billing_city","billing_address_1")}catch(e){console.error("CitySelector Initialization Error:",e)}},1e3)};document.addEventListener("DOMContentLoaded",S);
